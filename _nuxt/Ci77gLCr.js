import{aV as q,W as V,d as A,j as N,aR as U,k as B,U as m,c as w,e as f,s as b,w as R,h as _,aL as $,q as F,v as G,a3 as J,f as K,t as Q,x as Z,aW as tt,C as et}from"./CZ2IasxP.js";function nt(a){return a instanceof Element?a.getBoundingClientRect():a}const x=a=>typeof a=="number"?`${a}px`:a;function Y(a,y,l){const d=q(y).map(o=>nt(V(o)));return V(a).animate(d.map(o=>({left:x(o.left),top:x(o.top),width:x(o.width),height:x(o.height)})),{duration:100,fill:"forwards",...l})}const it={class:"z-lightbox"},ot={key:0,class:"tooltip"},at={key:0,class:"caption"},P=.8,st=A({__name:"Lightbox",props:{el:{},caption:{},isOpening:{type:Boolean}},emits:["close"],setup(a,{emit:y}){const l=a,d=y,o=l.el.getBoundingClientRect(),M=N(),g=U(M),{width:k,height:X}=tt();let p,C,O;const u=N({}),E=B(()=>Object.values(u.value).slice(0,2)),v=B(()=>L("current")),z=B(()=>j("current"));function H(t,e,n){if(n<1)return t<Math.min(k.value,o.width,l.el.naturalWidth)&&e<Math.min(X.value,o.height,l.el.naturalHeight);if(n>1)return t>Math.max(k.value,o.width,l.el.naturalWidth)&&e>Math.max(X.value,o.height,l.el.naturalHeight)}function D(t){const{left:e,top:n,width:i,height:s}=g.value.getBoundingClientRect();if(H(i,s,1-t.deltaY))return;const r=Math.abs(t.deltaY)<8?Math.abs(t.deltaY)*.05:.5,c=t.deltaY>0?1/(1+r):1+r;Y(g,{left:e-(t.clientX-e)*(c-1),top:n-(t.clientY-n)*(c-1),width:i*c,height:s*c})}function I(){for(const t of Object.values(u.value))t.startX=t.currentX,t.startY=t.currentY;p=g.value.getBoundingClientRect(),C=L("start"),O=j("start")}function L(t){const e=E.value;return{x:e.reduce((n,i)=>n+i[`${t}X`],0)/e.length,y:e.reduce((n,i)=>n+i[`${t}Y`],0)/e.length}}function j(t){const[e,n]=E.value;return!e||!n?0:Math.hypot(e[`${t}X`]-n[`${t}X`],e[`${t}Y`]-n[`${t}Y`])}m("pointerdown",t=>{u.value[t.pointerId]={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY},I()}),m("pointermove",t=>{const e=u.value[t.pointerId];if(!e)return;e.currentX=t.clientX,e.currentY=t.clientY;const n=z.value/O||1,i=p.width*n,s=p.height*n;if(H(i,s,n))return;const h=p.left+v.value.x-C.x,r=p.top+v.value.y-C.y,c=h-(v.value.x-h)*(n-1),W=r-(v.value.y-r)*(n-1);Y(g,{left:c,top:W,width:i,height:s},{duration:0})}),m("pointerup",t=>{delete u.value[t.pointerId],Object.keys(u.value).length&&I()});function S(t,e){const n=window.innerWidth*P,i=window.innerHeight*P,s=l.el.naturalWidth/l.el.naturalHeight,[h,r]=n/i>s?[i*s,i]:[n,n/s],c=(k.value-h)/2,W=(X.value-r)/2;Y(t,[o,{left:c,top:W,width:h,height:r}]).onfinish=e}function T(t,e){Y(t,l.el).onfinish=e}return m("keydown",t=>{t.key==="Escape"&&d("close")}),(t,e)=>{const n=G,i=Z;return f(),w("div",it,[b($,null,{default:R(()=>[t.isOpening?(f(),w("div",{key:0,id:"z-lightbox-bgmask",onClick:e[0]||(e[0]=s=>d("close"))})):_("",!0)]),_:1}),b($,{onEnter:S,onLeave:T},{default:R(()=>[t.isOpening?(f(),F(n,{key:0,ref_key:"lightbox",ref:M,class:"image",alt:t.el.alt,width:t.el.width,height:t.el.height,src:t.el.src,draggable:"false",onWheel:J(D,["prevent"])},null,8,["alt","width","height","src"])):_("",!0)]),_:1}),b($,null,{default:R(()=>[t.isOpening?(f(),w("div",ot,[t.caption?(f(),w("span",at,Q(t.caption),1)):_("",!0),K("button",{class:"close","aria-label":"关闭灯箱",onClick:e[1]||(e[1]=s=>d("close"))},[b(i,{name:"ph:x-bold"})])])):_("",!0)]),_:1})])}}}),rt=Object.assign(et(st,[["__scopeId","data-v-b625f5ef"]]),{__name:"PopoverLightbox"});export{rt as default};
