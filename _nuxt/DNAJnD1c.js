import{d as rt,c as q,r as at,as as ct,at as it,B as ft,au as ut,av as pt,q as R,E as F,D,u as I,G as W,a5 as X,aa as dt,o as P,aw as ht,_ as mt}from"./DFTVe4bk.js";function z(n,t,e,s){let o=0;for(;o<n.length;o++){const g=(e==null?void 0:e(o))??t[o];if(n[o]!==g||s!=null&&s(o))break}let l=n.length-1,h=t.length-1;for(;l>=0&&h>=0;l--,h--){const g=(e==null?void 0:e(h))??t[h];if(n[l]!==g||s!=null&&s(h))break}return o>l&&([o,l]=[l,o]),o=Math.max(0,o),l=Math.min(n.length-1,l)+1,n.length===t.length&&o+1===l?[o,l]:gt([...n],o,l)}function gt(n,t,e){const s=o(Math.max(0,t+e-n.length));t-=s,e+=s;function o(m){const a=n.slice(0,t).indexOf(n[e],m);if(a===-1)return 0;for(let r=a,i=e;r<t-1;i++,r++)if(n[r+1]!==n[i+1])return o(m+1);return t-a}const l=n.join(`
`),h=n.slice(0,t).join(`
`).length,g=n.slice(0,e).join(`
`).length,x=[];for(let m=t-1,a=g-1;m<e&&a>=h;m--){const r=n[m],i=l.lastIndexOf(r,a);if(i!==-1&&i>=h)x.push(r),a=i-1;else break}const b=[];for(let m=e,a=h;m>=t&&a<g;m++){const r=n[m],i=l.indexOf(r,a);if(i!==-1&&i<g)b.push(r),a=i+1;else break}return[t-x.length,e+b.length]}function St(n,t){let e=0,s;return function(...o){s&&(clearTimeout(s),s=void 0);const l=performance.now();!e||l-e>=t?(n.apply(this,o),e=l):s=setTimeout(()=>{n.apply(this,o),e=performance.now(),s=void 0},t+e-l)}}function kt(n){let t=!1;return function(...e){return t?!1:(t=!0,n.apply(this,e),!0)}}function yt(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function vt(n){const t=()=>"CSS"in globalThis&&"highlights"in CSS;function e(s,o){const{lang:l,themes:h={light:"min-light",dark:"min-dark"},defaultTheme:g="light",selector:x=v=>`.${v}`,defaultSelector:b=":root",watch:m=!0,delay:a=33.4}=o,r=new CSSStyleSheet;document.adoptedStyleSheets.push(r);const i=new Map,c=[];function V(v,d){for(const{range:S,name:p}of J(d)){const f=CSS.highlights.get(p);f==null||f.delete(S);const u=i.get(p);u==null||u.delete(S)}for(const{range:S,color:p,theme:f,name:u}of J(v)){const k=f===g;let w=CSS.highlights.get(u);w||(CSS.highlights.set(u,w=new Highlight),w.priority=k?0:1);let C=i.get(u);if(!C){i.set(u,C=new Set);const _=`${k?b:x(f)}::highlight(${u}) { color: ${p}; }`;r.insertRule(_)}w.add(S),C.add(S)}}function Q(v,d,S){var O;if(S-d>1||c.length<=d)return;const p=v[d],f=c[d],u=z(p,f.text),k=f.offset+u[0],w=f.offset+u[1],C=(O=f.loads)==null?void 0:O.find(({range:E})=>k>=E.startOffset&&k<E.endOffset);if(!C)return;const{range:_}=C;_.setEnd(_.endContainer,Math.max(_.endOffset,w))}const Y=St((v,d,S,p,f)=>{var O,E,A,H,U;const u=f-d.length+c.length,k=c.splice(u);for(let y=p;y<u;y++)V([],((O=c[y])==null?void 0:O.loads)??[]);const w=(E=c.at(-1))==null?void 0:E.lastGrammarState;c.length=f-1,c.fill(null,p,f-1),c.push(K({lastGrammarState:w}),...k);let C=d.slice(0,p).reduce((y,$)=>y+$.length+1,0);const _=bt(v,S,C);for(let y=p;y<d.length;y++){const $=d[y],j=n.codeToTokens($,{lang:l,themes:h,cssVariablePrefix:"",defaultColor:!1,grammarState:(A=c[y-1])==null?void 0:A.lastGrammarState}),M=[];for(const G of j.tokens[0]){const[nt,ot]=_(C+G.offset),[st,lt]=_(C+G.offset+G.content.length),T=document.createRange();T.setStart(nt,ot),T.setEnd(st,lt),M.push({token:G,range:T})}const N=c[y]??(c[y]=K());V(M,N.loads),N.loads=M,N.text=$,N.offset=C;const L=((H=N.lastGrammarState)==null?void 0:H.getScopes())??[Number.NaN],tt=((U=j.grammarState)==null?void 0:U.getScopes())??[Number.NaN],et=yt(L,tt);if(N.lastGrammarState=j.grammarState,!et)C+=$.length+1;else break}},a);t()&&(m&&s.addEventListener("input",B),B());const Z=kt(()=>{m&&s.removeEventListener("input",B);const v=document.adoptedStyleSheets.indexOf(r);document.adoptedStyleSheets.splice(v,1);for(const[d,S]of i){const p=CSS.highlights.get(d);for(const f of S)p==null||p.delete(f)}});function B(){const{innerText:v}=s,d=v.split(`
`),S=Ct(s),[p,f]=z(d,c,u=>{var k;return(k=c[u])==null?void 0:k.text},u=>{var k;return(k=c[u])==null?void 0:k.loads.some(({range:w})=>w.collapsed)});Q(d,p,f),Y(v,d,S,p,f)}return{dispose:Z,update:B}}return{get isSupported(){return t()},mount:e}}function*J(n){for(const{token:t,range:e}of n)if(typeof t.htmlStyle=="object")for(const s in t.htmlStyle){const o=t.htmlStyle[s],l=`shiki-${s}-${o.slice(1).toLowerCase()}`;yield{range:e,color:o,theme:s,name:l}}}function Ct(n){const t=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),e=[];let s;for(;s=t.nextNode();)e.push(s);return e}function K(n={}){return{text:"",offset:0,lastGrammarState:void 0,loads:[],...n}}function bt(n,t,e){let s=0,o=0,l=!1;return e>0&&h(e),h;function h(g){for(;s<t.length;s++){const x=t[s],{textContent:b}=x;if(b)if(l||(o=n.indexOf(b,o),l=!0),o+b.length<g)o+=b.length,l=!1;else break}return[t[s],g-o]}}const wt={class:"copy"},xt={key:0,class:"prompt"},_t=["textContent"],Nt=rt({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(n){const t=n,e=q(()=>t.prompt!==!0),s=q(()=>t.lang??ht(t.prompt)),o=at(!1),l=ct("code-input"),{copy:h,copied:g}=it(l);function x(){l.value&&(l.value.textContent=t.code??"",l.value.dispatchEvent(new Event("input")),o.value=!1)}function b(a){const{data:r,inputType:i}=a;(r!=null&&r.includes(`
`)||i==="insertLineBreak")&&a.preventDefault()}function m(a){o.value=t.code!==a.target.textContent}return ft(async()=>{const a=await ut(),r=await pt({lang:s.value});vt(a).mount(l.value,r)}),(a,r)=>{const i=dt;return P(),R("code",wt,[I(e)?(P(),R("span",xt,W(a.prompt),1)):F("",!0),D("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code",spellcheck:"false",onBeforeinput:r[0]||(r[0]=c=>b(c)),onInput:r[1]||(r[1]=c=>m(c)),textContent:W(a.code)},null,40,_t),r[3]||(r[3]=D("div",{class:"mask"},null,-1)),I(o)?(P(),R("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:x},[X(i,{name:"ph:arrow-u-up-left-bold"})])):F("",!0),D("button",{class:"operation","aria-label":"复制",onClick:r[2]||(r[2]=c=>I(h)())},[X(i,{name:I(g)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),Et=mt(Nt,[["__scopeId","data-v-b8f384bf"]]);export{Et as default};
