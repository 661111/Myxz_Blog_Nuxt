import{x as R,y as T,z as U,A as B,r as i,B as V,m as q,q as r,C as t,D as F,E as N,F as l,G as y,H as O,I as G,J as P,K as Q,o as c}from"./B76dQ47G.js";const W={class:"article-list"},X={key:0,class:"random-article"},Y={class:"article-container gradient-card"},Z={class:"article-author"},tt={class:"article-title"},et={class:"article-date"},at={class:"articles-list"},st=["onClick"],ot=["src"],it={class:"article-container gradient-card"},lt={class:"article-author"},nt=["onClick"],rt={class:"article-date"},ct={class:"load-more-container"},dt={class:"modal-content"},ut=["src"],vt=["href"],mt={id:"modal-articles-container"},_t=["href"],ht={class:"modal-article-date"},gt=["src"],wt={__name:"moment",setup(pt){const $=R();T().setAside(["blog-stats","connectivity","blog-log"]),U({title:"友链朋友圈",meta:[{property:"og:type",content:"profile"},{name:"description",content:`${$.title}的友链朋友圈页面。`}]});const u=B({private_api_url:"https://moments.myxz.top/",page_turning_number:20,error_img:"https://fastly.jsdelivr.net/gh/willow-god/Friend-Circle-Lite@latest/static/favicon.ico"}),d=i([]),g=i([]),v=B({friends_num:0,active_num:0,article_num:0,last_updated_time:""}),m=i(0),A=i(!0),n=i(null),_=i(!1),b=i(""),p=i(""),C=i(""),S=i([]);V(()=>{j()}),q(()=>{window.removeEventListener("click",w)});const j=()=>{E()},E=async()=>{const e="friend-circle-lite-cache",s="friend-circle-lite-cache-time",a=new Date().getTime();try{if(localStorage){const x=localStorage.getItem(s);if(x&&a-x<10*60*1e3){const z=JSON.parse(localStorage.getItem(e));if(z){L(z);return}}}const h=await(await fetch(`${u.private_api_url}all.json`)).json();localStorage&&(localStorage.setItem(e,JSON.stringify(h)),localStorage.setItem(s,a.toString())),L(h)}catch(o){console.error("加载文章失败:",o)}},L=e=>{v.friends_num=e.statistical_data.friends_num,v.active_num=e.statistical_data.active_num,v.article_num=e.statistical_data.article_num,v.last_updated_time=e.statistical_data.last_updated_time;const s=e.article_data,a=[...d.value,...s];d.value=a;const o=a.slice(m.value,m.value+u.page_turning_number);g.value=[...g.value,...o],m.value+=u.page_turning_number,A.value=m.value<a.length,n.value||M()},D=e=>e?e.substring(0,10):"",M=()=>{if(d.value.length>0){const e=Math.floor(Math.random()*d.value.length);n.value=d.value[e]}},f=e=>e||u.error_img,k=e=>{e.target.src=u.error_img},H=e=>{window.open(e,"_blank")},J=()=>{n.value&&window.open(n.value.link,"_blank")},K=(e,s,a)=>{b.value=e,p.value=s,C.value=new URL(a).origin,S.value=d.value.filter(o=>o.author===e).slice(0,4),_.value=!0,document.body.classList.add("overflow-hidden"),window.addEventListener("click",w)},w=e=>{e.target.id==="modal"&&I()},I=()=>{_.value=!1,document.body.classList.remove("overflow-hidden"),window.removeEventListener("click",w)};return(e,s)=>(c(),r(y,null,[s[2]||(s[2]=t("link",{rel:"stylesheet",href:"/assets/css/moments.css"},null,-1)),t("div",W,[n.value?(c(),r("div",X,[s[1]||(s[1]=t("div",{class:"random-container-title"},"随机钓鱼",-1)),t("a",{href:"#",onClick:N(J,["prevent"]),class:"article-item"},[t("div",Y,[t("div",Z,l(n.value.author),1),t("div",tt,l(n.value.title),1),t("div",et,l(n.value.created),1)])]),t("button",{class:"refresh-btn gradient-card",onClick:M},s[0]||(s[0]=[t("span",{class:"iconify i-ph:arrows-clockwise","aria-hidden":"true"},null,-1)]))])):F("",!0),t("div",at,[(c(!0),r(y,null,O(g.value,(a,o)=>(c(),r("div",{key:o,class:"article-item"},[t("div",{class:"article-image",onClick:h=>K(a.author,a.avatar,a.link)},[t("img",{src:f(a.avatar),onError:k},null,40,ot)],8,st),t("div",it,[t("div",lt,l(a.author),1),t("div",{class:"article-title",onClick:h=>H(a.link)},l(a.title),9,nt),t("div",rt,l(D(a.created)),1)])]))),128))]),t("div",ct,[G(t("button",{class:"load-more gradient-card",onClick:E}," 再来亿点 ",512),[[P,A.value]])]),_.value?(c(),r("div",{key:1,id:"modal",class:Q(["modal",{"modal-open":_.value}]),onClick:N(I,["self"])},[t("div",dt,[t("img",{id:"modal-author-avatar",src:f(p.value),onError:k},null,40,ut),t("a",{id:"modal-author-name-link",href:C.value,target:"_blank"},l(b.value),9,vt),t("div",mt,[(c(!0),r(y,null,O(S.value,(a,o)=>(c(),r("div",{key:o,class:"modal-article"},[t("a",{class:"modal-article-title",href:a.link,target:"_blank"},l(a.title),9,_t),t("div",ht,"📅"+l(D(a.created)),1)]))),128))]),t("img",{id:"modal-bg",src:f(p.value),onError:k},null,40,gt)])],2)):F("",!0)])],64))}};export{wt as default};
